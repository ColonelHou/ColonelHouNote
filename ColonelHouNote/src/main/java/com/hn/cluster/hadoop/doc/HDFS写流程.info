http://www.jianshu.com/p/7e52a7f8d16d
写流程：
1.HDFS cli通过RPC连接到NN询问哪些DN上可以存储了此数据A(由HDFS Cli拆分3个Block块)，
    因为NN上存储着整个文件系统的元数据，它知道哪些DN上有空间存在此数据A；
    （先会检查确保这个文件不存在，并且Cli有权限）
2.NN通过查看元数据信息，发现DN1，DN3，DN7上有空间可以存在数据A并告诉HDFS Cli；
3.HDFS Cli收到NN返回的DN列表信息后，它会直接联系第一个DN1，让它准备好接收数据A(实际上就是建立彼此间TCP连接，
    然后将数据A和NN返回的所有关于DN元数据一并传给DN1【最后才会写的】)；
4.DN1与HDFS Cli建立好TCP连接后，它会把HDFS Cli要写的数据A的请求顺序传给DN2(在与HDFS Cli建立好TCP连接后
    从HDFS Cli获得的DN列表信息)，要求DN2也准备好接收数据A(建立DN2到DN1的TCP连接)；
5.同上，建立DN2到DN3的TCP连接
6.当DN3准备好后，它会通知DN2，表明可以开始接收数据A；同理DN2准备好后会通知DN1，表明可以开始接收数据A；
7.当HDFS Cli接收到DN1的成功反馈信息后，说明3个DN都准备好了，HDFS Cli就会开始往这三个DN写入数据A；
8.HDFS Cli往DN1写入数据A，DN1接收完数据A，它会顺序将数据A传输给DN2，然后由DN2传输给DN3，每个DN接收完数据A后，
     会发消息给NN，告诉数据A已经接收完毕，NN同时会根据接收到消息更新它保存的FS元数据信息。当数据A成功写入3个DN之后，
     DN1会发送一个成功信息给HDFS Cli，同时，HDFS Cli也会发一个数据成功写入的信息给NN，
     之后HDFS Cli才能开始继续处理下一下数据B；
     
如果在写入的时候出现故障：
    1.先关闭管线，确认把队列中任何数据包都添加回到数据队列的最前端，确保下游DN不会漏掉任何一个数据包。
    2.为存储在另一正常DN的当前数据块指定一个新的标识，并将该标识送给NN，以便故障DN在恢复后可以删除存储在部分数据块。
    3.从管线中删除故障数据节点并且把余下数据块写入管线中两个正常的DN
    
    
给码农销售过程：
我去某大楼找楼主（NN）询问那层楼层（机架）及单元（DN）住的是码农，楼主先看我是不是来找事的以及查看楼中（数据中心）是否有码农入住中，
楼主（NN）查看后给我说那层(1,2)那单元(1-1xx(DN1), 1-2xx(DN2), 2-6XX(DN3))有，我收到楼主回应后，直接联系1-1xx了， 
我靠， 没想到这三个货（码农）一块的，相互去联系要不要推荐的Mac(数据data)，三个货都说要后由1-1xx通知我后，我就把Mac给1-1XX了，1-1XX把Mac以此给1-2xx,和2-6xx，
最后1-1xx通知我他们都已经收到。
如果1-1xx（DN1）送电脑过程中出意外(故障)了，中止派送然后完整的把Mac放回原处，然后联系楼主某单元哥们住院了，如果回来就把我传送的资源删除了。
    
入住过程:
我和朋友(Cli)通过58同城(RPC)找到房东(NN)咨询哪些层楼(DN)可以入住(存储数据),
房东看此人面熟查看是否已经在此居住[防止在此居住的房客搞中间骗人]及合条件居住[防止恐怖分子](权限审核), 
审核通过后房东（NN）发现1、3、7层楼可以(冗余块个数)入住(存数据)并告诉我和朋友(Cli), 
我和朋友收到房东(NN)给的楼层及房间号(DN信息)后，我们(Cli)直接去第一个楼层(DN1)见到服务员看打开房间准备往进搬东西(DATA块)
(识路:建立TCP连接)，接着到第三楼层(DN3)把房间打开准备好往进搬东西(DATA块),
然后到第7楼层把房间打开做同样的准备并建立3楼到7楼的路(建立TCP连接)， 7楼准备就绪后通知3楼表明可以往进搬东西了，
同理3楼准备好后会通知1楼，我们服务员会我说1楼准备就绪(DN1就绪),说明三个房间都准备好了，我们就会把东西往一楼搬，搬完后，
会顺序将一楼的东西顺序搬到三楼及三楼到七楼; 每个楼层的房间搬完东西后服务员会告诉房东(NN)此层此房间入住完成，
房东会保存此住户信息到系统中(FSImage)中，三个都完成后， 我们(Cli)会给房东(NN)说入住成功的信息；之后再有租房的来，
也是同理入住发现有问题的房间：
  先暂停往进搬东西(关闭管线)， 把搬进去的东西拿出来到搬东西的队列最前端，确保下游房间不会少任何东西(数据包),
   给当前所有东西做个标识并发给房东， 等房间可以入住时把此标识的部分东西干掉；然后写入余下的DN；