<!DOCTYPE html>
<!-- saved from url=(0036)http://www.alidata.org/archives/1470 -->
<html class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" lang="zh-CN"><!--<![endif]--><!-- the "no-js" class is for Modernizr. --><head id="www-sitename-com" data-template-set="html5-reset-wordpress-theme" profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<meta charset="UTF-8">
	
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	
	<title>
		     hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org	</title>
	
	<meta name="title" content="  hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org">
	<meta name="description" content="西湖之滨，白云之上">
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Your Name Here">
	<meta name="Copyright" content="Copyright Your Name Here 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Project Name">
	<meta name="DC.subject" content="What you&#39;re about.">
	<meta name="DC.creator" content="Who made this site.">
	
	<!--  Mobile Viewport meta tag
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width -->
	<!-- Uncomment to use; use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->
	
	<link rel="shortcut icon" href="http://www.alidata.org/wp-content/themes/tbdata-HTML5-Reset/_/img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="http://www.alidata.org/wp-content/themes/tbdata-HTML5-Reset/_/img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="http://www.alidata.org/wp-content/themes/tbdata-HTML5-Reset/style.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script async="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/analytics.js"></script><script src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/modernizr-1.7.min.js"></script>
	
	<link rel="pingback" href="http://www.alidata.org/xmlrpc.php">


<meta name="generator" content="TBdata 3.6.1"> <!-- leave this for stats please -->
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://www.alidata.org/feed">
<link rel="alternate" type="text/xml" title="RSS .92" href="http://www.alidata.org/feed/rss">
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://www.alidata.org/feed/atom">
<script type="text/javascript" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/jquery.js"></script>

<script src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/mustache.js"></script>
	
	<link rel="alternate" type="application/rss+xml" title="阿里数据平台 alidata.org » Feed" href="http://www.alidata.org/feed">
<link rel="alternate" type="application/rss+xml" title="阿里数据平台 alidata.org » 评论Feed" href="http://www.alidata.org/comments/feed">
<link rel="alternate" type="application/rss+xml" title="阿里数据平台 alidata.org » hadoop作业调优参数整理及原理评论Feed" href="http://www.alidata.org/archives/1470/feed">
<script type="text/javascript" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/jquery(1).js"></script>
<script type="text/javascript" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/comment-reply.min.js"></script>
<link rel="prev" title="mysql数据压缩性能对比（二）" href="http://www.alidata.org/archives/1463">
<link rel="next" title="hbase介绍" href="http://www.alidata.org/archives/1509">
<link rel="canonical" href="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org.html">
<link rel="shortlink" href="http://www.alidata.org/?p=1470">

<link rel="stylesheet" href="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/wp-syntax.css" type="text/css" media="screen">
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<!-- begin SI CAPTCHA Anti-Spam - comment form style --><style type="text/css">div#captchaImgDiv { display:block; }.captchaSizeDivSmall { width:175px; height:45px; padding-top:10px; }.captchaSizeDivLarge { width:250px; height:60px; padding-top:10px; }img#si_image_com,#si_image_reg,#si_image_log,#si_image_side_login { border-style:none; margin:0; padding-right:5px; float:left; }.captchaImgRefresh { border-style:none; margin:0; vertical-align:bottom; }div#captchaInputDiv { display:block; padding-top:15px; padding-bottom:5px; }label#captcha_code_label { margin:0; }input#captcha_code { width:65px; }</style><!-- end SI CAPTCHA Anti-Spam - comment form style --></head>

<body class="single single-post postid-1470 single-format-standard">
	<div id="wrapper" class="clearfix">
	<header id="header">
		<div id="logo"><a href="http://www.alidata.org/"><img src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/logo.png" alt="阿里数据平台 alidata.org"></a></div>
				<div class="menu"><ul><li><a href="http://www.alidata.org/" title="首页">首页</a></li><li class="page_item page-item-1858 sub"><a href="http://www.alidata.org/about-us" class="sub">关于我们</a><ul class="children"><li class="page_item page-item-1862"><a href="http://www.alidata.org/about-us/departments">部门介绍</a></li><li class="page_item page-item-1865"><a href="http://www.alidata.org/about-us#team">团队文化</a></li><li class="page_item page-item-1882"><a href="http://www.alidata.org/about-us/tech">技术</a></li><li class="page_item page-item-1884"><a href="http://www.alidata.org/about-us/product">产品</a></li><li class="page_item page-item-2017 last"><a href="http://www.alidata.org/about-us/star">达摩院</a></li></ul></li><li class="page_item page-item-1875"><a href="http://www.alidata.org/join-us">加入我们</a></li><li class="page_item page-item-1888"><a href="http://www.alidata.org/archives">官方博客</a></li></ul></div>
	</header>
</div>

	<div id="page-wrap" class="clearfix">
	<!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->




<div id="bd" class="grid-m0s7 clearfix">
	<div id="mainbox" class="col-main">
		<div class="main-wrap">				
					<article class="post-1470 post type-post status-publish format-standard hentry category-hadoop category-cloud-computing" id="post-1470">
						
						<h1 class="entry-title">hadoop作业调优参数整理及原理</h1>
				
						<div class="entry-content">
							
							<h1>1 Map side tuning参数</h1>
<h2>1.1 MapTask运行内部原理</h2>
<p><a href="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/mapTask.jpg"><img class="alignnone size-full wp-image-1471" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/mapTask.jpg" alt="" width="413" height="306"></a></p>
<p>当map task开始运算，并产生中间数据时，其产生的中间结果并非直接就简单的写入磁盘。这中间的过程比较复杂，并且利用到了内存buffer来进行已经产生的部分结果的缓存，并在内存buffer中进行一些预排序来优化整个map的性能。如上图所示，每一个map都会对应存在一个内存buffer（MapOutputBuffer，即上图的buffer in memory），map会将已经产生的部分结果先写入到该buffer中，这个buffer默认是100MB大小，但是这个大小是可以根据job提交时的参数设定来调整的，该参数即为：<strong>io.sort.mb</strong>。当map的产生数据非常大时，并且把io.sort.mb调大，那么map在整个计算过程中spill的次数就势必会降低，map task对磁盘的操作就会变少，如果map tasks的瓶颈在磁盘上，这样调整就会大大提高map的计算性能。map做sort和spill的内存结构如下如所示：</p>
<p><a href="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/mapSpill1.jpg"><img class="alignnone size-full wp-image-1478" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/mapSpill1.jpg" alt="" width="548" height="385"></a></p>
<p>map在运行过程中，不停的向该buffer中写入已有的计算结果，但是该buffer并不一定能将全部的map输出缓存下来，当map输出超出一定阈值（比如100M），那么map就必须将该buffer中的数据写入到磁盘中去，这个过程在mapreduce中叫做spill。map并不是要等到将该buffer全部写满时才进行spill，因为如果全部写满了再去写spill，势必会造成map的计算部分等待buffer释放空间的情况。所以，map其实是当buffer被写满到一定程度（比如80%）时，就开始进行spill。这个阈值也是由一个job的配置参数来控制，即<strong>io.sort.spill.percent</strong>，默认为0.80或80%。这个参数同样也是影响spill频繁程度，进而影响map task运行周期对磁盘的读写频率的。但非特殊情况下，通常不需要人为的调整。调整io.sort.mb对用户来说更加方便。</p>
<p>当map task的计算部分全部完成后，如果map有输出，就会生成一个或者多个spill文件，这些文件就是map的输出结果。map在正常退出之前，需要将这些spill合并（merge）成一个，所以map在结束之前还有一个merge的过程。merge的过程中，有一个参数可以调整这个过程的行为，该参数为：<strong>io.sort.factor</strong>。该参数默认为10。它表示当merge spill文件时，最多能有多少并行的stream向merge文件中写入。比如如果map产生的数据非常的大，产生的spill文件大于10，而io.sort.factor使用的是默认的10，那么当map计算完成做merge时，就没有办法一次将所有的spill文件merge成一个，而是会分多次，每次最多10个stream。这也就是说，当map的中间结果非常大，调大io.sort.factor，有利于减少merge次数，进而减少map对磁盘的读写频率，有可能达到优化作业的目的。</p>
<p>当job指定了combiner的时候，我们都知道map介绍后会在map端根据combiner定义的函数将map结果进行合并。运行combiner函数的时机有可能会是merge完成之前，或者之后，这个时机可以由一个参数控制，即<strong>min.num.spill.for.combine</strong>（default 3），当job中设定了combiner，并且spill数最少有3个的时候，那么combiner函数就会在merge产生结果文件之前运行。通过这样的方式，就可以在spill非常多需要merge，并且很多数据需要做conbine的时候，减少写入到磁盘文件的数据数量，同样是为了减少对磁盘的读写频率，有可能达到优化作业的目的。</p>
<p>减少中间结果读写进出磁盘的方法不止这些，还有就是压缩。也就是说map的中间，无论是spill的时候，还是最后merge产生的结果文件，都是可以压缩的。压缩的好处在于，通过压缩减少写入读出磁盘的数据量。对中间结果非常大，磁盘速度成为map执行瓶颈的job，尤其有用。控制map中间结果是否使用压缩的参数为：<strong>mapred.compress.map.output</strong>(true/false)。将这个参数设置为true时，那么map在写中间结果时，就会将数据压缩后再写入磁盘，读结果时也会采用先解压后读取数据。这样做的后果就是：写入磁盘的中间结果数据量会变少，但是cpu会消耗一些用来压缩和解压。所以这种方式通常适合job中间结果非常大，瓶颈不在cpu，而是在磁盘的读写的情况。说的直白一些就是用cpu换IO。根据观察，通常大部分的作业cpu都不是瓶颈，除非运算逻辑异常复杂。所以对中间结果采用压缩通常来说是有收益的。以下是一个wordcount中间结果采用压缩和不采用压缩产生的map中间结果本地磁盘读写的数据量对比：</p>
<p><strong>map</strong><strong>中间结果不压缩：</strong></p>
<p><a href="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/job_un_codec.jpg"><img class="alignnone size-full wp-image-1473" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/job_un_codec.jpg" alt="" width="577" height="200"></a></p>
<p><strong>map</strong><strong>中间结果压缩：</strong></p>
<p><strong><a href="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/job_codec.jpg"><img class="alignnone size-full wp-image-1474" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/job_codec.jpg" alt="" width="577" height="200"></a><br>
</strong></p>
<p><strong> </strong></p>
<p>可以看出，同样的job，同样的数据，在采用压缩的情况下，map中间结果能缩小将近10倍，如果map的瓶颈在磁盘，那么job的性能提升将会非常可观。</p>
<p>当采用map中间结果压缩的情况下，用户还可以选择压缩时采用哪种压缩格式进行压缩，现在hadoop支持的压缩格式有：GzipCodec，LzoCodec，BZip2Codec，LzmaCodec等压缩格式。通常来说，想要达到比较平衡的cpu和磁盘压缩比，LzoCodec比较适合。但也要取决于job的具体情况。用户若想要自行选择中间结果的压缩算法，可以设置配置参数：<strong>mapred.map.output.compression.codec</strong>=org.apache.hadoop.io.compress.DefaultCodec或者其他用户自行选择的压缩方式。</p>
<h2>1.2 Map side相关参数调优</h2>
<table border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td width="234" valign="top"><strong>选项</strong></td>
<td width="98" valign="top"><strong>类型</strong></td>
<td width="149" valign="top"><strong>默认值</strong></td>
<td width="87" valign="top"><strong>描述</strong></td>
</tr>
<tr>
<td width="234" valign="top">io.sort.mb</td>
<td width="98" valign="top">int</td>
<td width="149" valign="top">100</td>
<td width="87" valign="top">缓存map中间结果的buffer大小(in MB)</td>
</tr>
<tr>
<td width="234" valign="top">io.sort.record.percent</td>
<td width="98" valign="top">float</td>
<td width="149" valign="top">0.05</td>
<td width="87" valign="top">io.sort.mb中用来保存map output记录边界的百分比，其他缓存用来保存数据</td>
</tr>
<tr>
<td width="234" valign="top">io.sort.spill.percent</td>
<td width="98" valign="top">float</td>
<td width="149" valign="top">0.80</td>
<td width="87" valign="top">map开始做spill操作的阈值</td>
</tr>
<tr>
<td width="234" valign="top">io.sort.factor</td>
<td width="98" valign="top">int</td>
<td width="149" valign="top">10</td>
<td width="87" valign="top">做merge操作时同时操作的stream数上限。</td>
</tr>
<tr>
<td width="234" valign="top">min.num.spill.for.combine</td>
<td width="98" valign="top">int</td>
<td width="149" valign="top">3</td>
<td width="87" valign="top">combiner函数运行的最小spill数</td>
</tr>
<tr>
<td width="234" valign="top">mapred.compress.map.output</td>
<td width="98" valign="top">boolean</td>
<td width="149" valign="top">false</td>
<td width="87" valign="top">map中间结果是否采用压缩</td>
</tr>
<tr>
<td width="234" valign="top">mapred.map.output.compression.codec</td>
<td width="98" valign="top">class name</td>
<td width="149" valign="top">org.apache.hadoop.io.<p></p>
<p>compress.DefaultCodec</p></td>
<td width="87" valign="top">map中间结果的压缩格式</td>
</tr>
</tbody>
</table>
<h1>2 Reduce side tuning参数</h1>
<h2>2.1 ReduceTask运行内部原理</h2>
<p><a href="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/reduceTask.jpg"><img class="alignnone size-full wp-image-1475" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/reduceTask.jpg" alt="" width="295" height="221"></a></p>
<p>reduce的运行是分成三个阶段的。分别为copy-&gt;sort-&gt;reduce。由于job的每一个map都会根据reduce(n)数将数据分成map 输出结果分成n个partition，所以map的中间结果中是有可能包含每一个reduce需要处理的部分数据的。所以，为了优化reduce的执行时间，hadoop中是等job的第一个map结束后，所有的reduce就开始尝试从完成的map中下载该reduce对应的partition部分数据。这个过程就是通常所说的shuffle，也就是copy过程。</p>
<p>Reduce task在做shuffle时，实际上就是从不同的已经完成的map上去下载属于自己这个reduce的部分数据，由于map通常有许多个，所以对一个reduce来说，下载也可以是并行的从多个map下载，这个并行度是可以调整的，调整参数为：<strong>mapred.reduce.parallel.copies</strong>（default 5）。默认情况下，每个只会有5个并行的下载线程在从map下数据，如果一个时间段内job完成的map有100个或者更多，那么reduce也最多只能同时下载5个map的数据，所以这个参数比较适合map很多并且完成的比较快的job的情况下调大，有利于reduce更快的获取属于自己部分的数据。</p>
<p>reduce的每一个下载线程在下载某个map数据的时候，有可能因为那个map中间结果所在机器发生错误，或者中间结果的文件丢失，或者网络瞬断等等情况，这样reduce的下载就有可能失败，所以reduce的下载线程并不会无休止的等待下去，当一定时间后下载仍然失败，那么下载线程就会放弃这次下载，并在随后尝试从另外的地方下载（因为这段时间map可能重跑）。所以reduce下载线程的这个最大的下载时间段是可以调整的，调整参数为：<strong>mapred.reduce.copy.backoff</strong>（default 300秒）。如果集群环境的网络本身是瓶颈，那么用户可以通过调大这个参数来避免reduce下载线程被误判为失败的情况。不过在网络环境比较好的情况下，没有必要调整。通常来说专业的集群网络不应该有太大问题，所以这个参数需要调整的情况不多。</p>
<p>Reduce将map结果下载到本地时，同样也是需要进行merge的，所以io.sort.factor的配置选项同样会影响reduce进行merge时的行为，该参数的详细介绍上文已经提到，当发现reduce在shuffle阶段iowait非常的高的时候，就有可能通过调大这个参数来加大一次merge时的并发吞吐，优化reduce效率。</p>
<p>Reduce在shuffle阶段对下载来的map数据，并不是立刻就写入磁盘的，而是会先缓存在内存中，然后当使用内存达到一定量的时候才刷入磁盘。这个内存大小的控制就不像map一样可以通过io.sort.mb来设定了，而是通过另外一个参数来设置：<strong>mapred.job.shuffle.input.buffer.percent</strong>（default 0.7），这个参数其实是一个百分比，意思是说，shuffile在reduce内存中的数据最多使用内存量为：0.7 × maxHeap of reduce task。也就是说，如果该reduce task的最大heap使用量（通常通过mapred.child.java.opts来设置，比如设置为-Xmx1024m）的一定比例用来缓存数据。默认情况下，reduce会使用其heapsize的70%来在内存中缓存数据。如果reduce的heap由于业务原因调整的比较大，相应的缓存大小也会变大，这也是为什么reduce用来做缓存的参数是一个百分比，而不是一个固定的值了。</p>
<p>假设mapred.job.shuffle.input.buffer.percent为0.7，reduce task的max heapsize为1G，那么用来做下载数据缓存的内存就为大概700MB左右，这700M的内存，跟map端一样，也不是要等到全部写满才会往磁盘刷的，而是当这700M中被使用到了一定的限度（通常是一个百分比），就会开始往磁盘刷。这个限度阈值也是可以通过job参数来设定的，设定参数为：<strong>mapred.job.shuffle.merge.percent</strong>（default 0.66）。如果下载速度很快，很容易就把内存缓存撑大，那么调整一下这个参数有可能会对reduce的性能有所帮助。</p>
<p>当reduce将所有的map上对应自己partition的数据下载完成后，就会开始真正的reduce计算阶段（中间有个sort阶段通常时间非常短，几秒钟就完成了，因为整个下载阶段就已经是边下载边sort，然后边merge的）。当reduce task真正进入reduce函数的计算阶段的时候，有一个参数也是可以调整reduce的计算行为。也就是：<strong>mapred.job.reduce.input.buffer.percent</strong>（default 0.0）。由于reduce计算时肯定也是需要消耗内存的，而在读取reduce需要的数据时，同样是需要内存作为buffer，这个参数是控制，需要多少的内存百分比来作为reduce读已经sort好的数据的buffer百分比。默认情况下为0，也就是说，默认情况下，reduce是全部从磁盘开始读处理数据。如果这个参数大于0，那么就会有一定量的数据被缓存在内存并输送给reduce，当reduce计算逻辑消耗内存很小时，可以分一部分内存用来缓存数据，反正reduce的内存闲着也是闲着。</p>
<h2>2.2 Reduce side相关参数调优</h2>
<table border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td width="234" valign="top"><strong>选项</strong></td>
<td width="57" valign="top"><strong>类型</strong></td>
<td width="66" valign="top"><strong>默认值</strong></td>
<td width="211" valign="top"><strong>描述</strong></td>
</tr>
<tr>
<td width="234" valign="top">mapred.reduce.parallel.copies</td>
<td width="57" valign="top">int</td>
<td width="66" valign="top">5</td>
<td width="211" valign="top">每个reduce并行下载map结果的最大线程数</td>
</tr>
<tr>
<td width="234" valign="top">mapred.reduce.copy.backoff</td>
<td width="57" valign="top">int</td>
<td width="66" valign="top">300</td>
<td width="211" valign="top">reduce下载线程最大等待时间（in sec）</td>
</tr>
<tr>
<td width="234" valign="top">io.sort.factor</td>
<td width="57" valign="top">int</td>
<td width="66" valign="top">10</td>
<td width="211" valign="top">同上</td>
</tr>
<tr>
<td width="234" valign="top">mapred.job.shuffle.input.buffer.percent</td>
<td width="57" valign="top">float</td>
<td width="66" valign="top">0.7</td>
<td width="211" valign="top">用来缓存shuffle数据的reduce task heap百分比</td>
</tr>
<tr>
<td width="234" valign="top">mapred.job.shuffle.merge.percent</td>
<td width="57" valign="top">float</td>
<td width="66" valign="top">0.66</td>
<td width="211" valign="top">缓存的内存中多少百分比后开始做merge操作</td>
</tr>
<tr>
<td width="234" valign="top">mapred.job.reduce.input.buffer.percent</td>
<td width="57" valign="top">float</td>
<td width="66" valign="top">0.0</td>
<td width="211" valign="top">sort完成后reduce计算阶段用来缓存数据的百分比</td>
</tr>
</tbody>
</table>
				
														
													
							<footer class="meta">
	<span class="byline author vcard">
		<i>by</i> <span class="fn"><a href="http://www.alidata.org/archives/author/guili" title="由guili发布" rel="author">guili</a></span>
	</span>
	<span class="sep">|</span>
	<span class="category"><a href="http://www.alidata.org/archives/category/cloud-computing/hadoop" title="查看hadoop中的全部文章" rel="category tag">hadoop</a>,<a href="http://www.alidata.org/archives/category/cloud-computing" title="查看云计算中的全部文章" rel="category tag">云计算</a></span>
	<span class="sep">|</span>
	<span class="comments"><a href="http://www.alidata.org/archives/1470#comments" title="《hadoop作业调优参数整理及原理》上的评论">Comments (30)</a></span>
	<span class="sep"></span>
	</footer>				
						</div>
						
					</article>
				
				
	
	<h2 id="comments">30 Responses</h2>

	<div class="navigation">
		<div class="next-posts"></div>
		<div class="prev-posts"></div>
	</div>

	<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="comment-5019">
				<div id="div-comment-5019" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/d8be25aed5776bf8035db3812a3185cf" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://www.adebug.com/" rel="external nofollow" class="url">adebug</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5019">
			一月 20, 20117:59 下午</a>		</div>

		<p>说得很全面很深入啊，学习了</p>
<p>reduce阶段还有一个可以优化的点，reduce在拖数据的时候，从一台机器一次性把多个map结果拖过来，而不是一次拖一点。<br>
这个很久之前在30台的集群上测试过，由于一开始跑不满网络，只能到10M左右，每次shuffle都特别慢，因此改进了这个功能，直接单机网络打满，可见这里也是有可改进的地方的，但是对于大规模的环境下时，由于瓶颈已经不在网络上，往往是在io下，因此这个feature不是特别有效。</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5023">
				<div id="div-comment-5023" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/af028e92875f49a468ae2673d3d4ed68" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">rqetqr</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5023">
			一月 20, 20118:59 下午</a>		</div>

		<p>好文章，赞</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5024">
				<div id="div-comment-5024" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/2152e87e161382ba72a57bb1b8c8b2b6" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">gaoyang</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5024">
			一月 20, 20119:29 下午</a>		</div>

		<p>好文，收藏了。</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5025">
				<div id="div-comment-5025" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/0cb45c1731c9691129c539aa8c625e92" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://blog.ring.idv.tw/" rel="external nofollow" class="url">Shen</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5025">
			一月 21, 20119:36 上午</a>		</div>

		<p>&gt;&gt;所以，为了优化reduce的执行时间，hadoop中是等job的第一个map结束后，所有的reduce就开始尝试从完成的map中下载该reduce对应的partition部分数据。</p>
<p>這句話不對，實際上來說Reduce階段是等Job已完成5%的Map tasks數量之後才開始啟動Reduce，此參數為：mapred.reduce.slowstart.completed.maps</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-guili bypostauthor even thread-even depth-1" id="comment-5026">
				<div id="div-comment-5026" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/b36a00e1b208f94d6848d89e1662e7df" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">guili</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5026">
			一月 21, 201110:08 上午</a>		</div>

		<p>@Shen  我们的hadoop版本里没有引入slowstart这个功能，所以…… ，呵呵</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5027">
				<div id="div-comment-5027" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/0cb45c1731c9691129c539aa8c625e92" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://blog.ring.idv.tw/" rel="external nofollow" class="url">Shen</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5027">
			一月 21, 201110:46 上午</a>		</div>

		<p>哦哦! 是採用0.19嗎？還是針對需求進行客製化的改寫？</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-guili bypostauthor even thread-even depth-1" id="comment-5029">
				<div id="div-comment-5029" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/b36a00e1b208f94d6848d89e1662e7df" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">guili</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5029">
			一月 21, 201111:03 上午</a>		</div>

		<p>@Shen 从08年开始基于0.19.1版本，做了无数的需求定制化改进</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5030">
				<div id="div-comment-5030" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/1d71be3075436648af02b47db2d04aac" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">panfei</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5030">
			一月 22, 201111:52 下午</a>		</div>

		<p>感谢分享经验</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5033">
				<div id="div-comment-5033" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/1d71be3075436648af02b47db2d04aac" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">panfei</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5033">
			一月 25, 20119:59 上午</a>		</div>

		<p>能分享一下你们是怎么检测hadoop作业的瓶颈的方法？</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5034">
				<div id="div-comment-5034" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/b36a00e1b208f94d6848d89e1662e7df" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">guili</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5034">
			一月 25, 20117:02 下午</a>		</div>

		<p>@panfei  这个说起来会很长，我们会在博客上持续更新分享我们的经验的～</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5035">
				<div id="div-comment-5035" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/c6aaf03dc8c7141847a2e389521b47b9" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Raymond</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5035">
			一月 26, 201110:36 下午</a>		</div>

		<p>写的很细致，很清晰。Hadoop在淘宝一定被优化了很多东西，楼主是否有整理和分享的计划？</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5036">
				<div id="div-comment-5036" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/b36a00e1b208f94d6848d89e1662e7df" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">guili</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5036">
			一月 27, 20119:09 上午</a>		</div>

		<p>@Raymond  多谢关注，我们会持续分享我们的经验，甚至开源我们的代码的。</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5037">
				<div id="div-comment-5037" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/f5bc03b7a33ba527048cf3ca3df0fb56" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">yfan</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5037">
			一月 28, 20119:53 上午</a>		</div>

		<p>好文，收获不少，你们非常open</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5041">
				<div id="div-comment-5041" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/727247143566025b213bfce379f89c76" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://www.easy-buy.in/" rel="external nofollow" class="url">Roger</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5041">
			二月 2, 20115:56 下午</a>		</div>

		<p>学习了，收获很多。写得非常清晰，非常好。<br>
请问可以转载吗？</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5046">
				<div id="div-comment-5046" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/b36a00e1b208f94d6848d89e1662e7df" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">guili</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5046">
			二月 10, 201110:05 上午</a>		</div>

		<p>@Roger  转载还请说明出处，谢谢～</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5071">
				<div id="div-comment-5071" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/71578a55f7e54efadf55c1934124a1b4" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">hadoop</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5071">
			三月 16, 201111:18 下午</a>		</div>

		<p>说的很好很全面，比definitive guide讲的还透彻，做performance tuning推荐一个工具ganglia，用于监控cluster的cpu，mem，network io等指标，逐一把硬件资源吃慢就tune到极限了;-)</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5072">
				<div id="div-comment-5072" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/b36a00e1b208f94d6848d89e1662e7df" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">guili</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5072">
			三月 17, 20113:57 下午</a>		</div>

		<p>@楼上<br>
呵呵，多谢，我们会继续分享我们的经验，欢迎交流。<br>
另外，ganglia我们从使用hadoop的第一天就在使用，还做了很多改造。内部我们不叫ganglia，都称它为“肛裂”：）</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5101">
				<div id="div-comment-5101" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/da6e5cc182c13cf1bb879fdf02176107" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Denny Ye</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5101">
			四月 1, 201111:29 上午</a>		</div>

		<p>Shuffle过程中, Reduce端需要不断地对从map端拉过来的数据做merge。最好的情况是就在内存中做merge，完了后直接作为reduce的输入数据。</p>
<p>开启这种MemToMem merge模式是将mapreduce.reduce.merge.memtomem.enabled设置为true。 当copy过来的数据太多时，超过一个内存限制，就会往磁盘做merge，我们应该最大限度地减少往磁盘merge，在这里设置mapreduce.reduce.shuffle.merge.percent，这个一个利用memoryLimit的比例，我给它设置为0.99,最大化地利用reduce端的内存来做merge。最后在做过一些内存间的merge后，你希望有多少内存来存储reduce的输入数据？mapreduce.reduce.input.buffer.percent，这个比例设置高些，这个数据设置的越大，在merge后期往磁盘merge数据就越少。我测试时设置是0.9。</p>
<p>在我的测试例子中，reduce端的所有merge处理都是在内存中发生，没有往磁盘写一点数据。merge流程从最初的接近8分钟减少到2分钟，这2分钟基本就是在拉取数据，内存中merge是很快的。</p>
<p>当然基于测试的数据是很理想化的，但上述的设置还是能最大化地减少reduce端对磁盘IO的操作。<br>
因为我测试的初衷是尽量让磁盘读写不要成为瓶颈。对于performance tuning的各种问题我们可以交流下，呵呵</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5102">
				<div id="div-comment-5102" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/da6e5cc182c13cf1bb879fdf02176107" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Denny Ye</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5102">
			四月 1, 201111:31 上午</a>		</div>

		<p>还有一个问题。我不清楚你的这些分析是基于Hadoop哪个版本的，但参数明显是挺老了，参数设置也很不灵活，很多时间没有将map与reduce的执行分开对待。只是个人感觉了</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5103">
				<div id="div-comment-5103" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/b36a00e1b208f94d6848d89e1662e7df" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">guili</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5103">
			四月 1, 20113:47 下午</a>		</div>

		<p>@Denny Ye<br>
我们的hadoop版本是0.19.1,至于为什么到现在还用这个版本就不详细解释了，总之是历史原因。<br>
关于tunning的经验，可以给我发邮件交流：luoli523@gmail.com</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1" id="comment-5292">
				<div id="div-comment-5292" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href="http://www.lifeyun.com/hadoop-mapreduce.html" rel="external nofollow" class="url">Hadoop MapReduce | LifeYun</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5292">
			九月 17, 20111:12 下午</a>		</div>

		<p>[...] 10.05pt;mso-layout-grid-align:none;text-autospace:none"&gt;1TB排序&nbsp;&nbsp;MapReduce&nbsp;hadoop的源码分析&nbsp;hadoop的源码分析&nbsp;Hadoop MapReduce优化&nbsp;Tuning Hadoop [...]</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5335">
				<div id="div-comment-5335" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/9ae2f83f4758dcb41c81cced2401a627" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">babyyellow</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5335">
			十一月 22, 20114:13 下午</a>		</div>

		<p>感谢分享！！！</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5341">
				<div id="div-comment-5341" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/6670f0d590d21ddde73112280795a081" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://www.arkilis.com/" rel="external nofollow" class="url">arkilis</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5341">
			十一月 30, 20118:25 上午</a>		</div>

		<p>reduce的运行是分成三个阶段的。分别为copy-&gt;sort-&gt;reduce。</p>
<p>==========================================================<br>
请教一下，这个copy 是复制什么，从哪里复制到哪里？<br>
谢谢</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-jijiannan odd alt thread-odd thread-alt depth-1" id="comment-5345">
				<div id="div-comment-5345" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/713671cbfa3681859aee7a60c12c5fe9" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">jijiannan</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5345">
			十二月 5, 201110:12 上午</a>		</div>

		<p>@arkilis<br>
copy是指将map的输出拷贝到运行Reduce的节点上</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1" id="comment-5374">
				<div id="div-comment-5374" class="comment-body">
				<div class="comment-author vcard">
						<cite class="fn"><a href="http://www.wikieno.com/?p=265" rel="external nofollow" class="url">小e的分享 | 独乐乐不如众乐乐 » MapReduce优化（一）</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5374">
			二月 11, 201211:36 下午</a>		</div>

		<p>[...] 这篇博文主要是解决上一篇&lt;迭代式MapReduce解决方案（一）&gt;中总结所提到的第三个问题，与网上大多数Hadoop调优（&lt;董的博客&gt;、&lt;淘宝数据平台&gt;）不太一样，网上告诉的是方法，但是方法是什么以及优化后能达到什么效果没有一个直观的感受。这篇博文讲述了一些简单的优化手段，可将140M的临时文件缩小到4.9M，期望能有一些对优化一些更为直观的感受，起到抛砖引玉的作用。 [...]</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5427">
				<div id="div-comment-5427" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/a7310c9a61887bb811a593e28db3c948" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">遥方</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5427">
			七月 16, 201210:17 下午</a>		</div>

		<p>嗨你好。我使用hadoop单JVM节点跑map-reduce想分析下apache的访问日志（大概500M）。发现总会报：<br>
Job not successful. Error: # of failed Map Tasks exceeded allowed limit<br>
请问下大概是什么原因呢？</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5446">
				<div id="div-comment-5446" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/10dad5b1a331cfc4b553e8de1ecefc39" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Niko7</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5446">
			八月 20, 20128:54 上午</a>		</div>

		<p>很高兴能读到这么好的文章，感谢分享！</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5447">
				<div id="div-comment-5447" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/1255848de0b23ce64dfce7335b6e7b5e" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Quinton</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5447">
			八月 26, 20123:25 下午</a>		</div>

		<p>对于这些tuning各个属性的具体的意思，你们是看hadoop权威指南获得的，还是官方文档，还是hadoop in action呢。那本书比较好，还是直接看官网？</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-5471">
				<div id="div-comment-5471" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/8bd9c131364e4dd7cac8442986af4383" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://www.diguage.com/" rel="external nofollow" class="url">D瓜哥</a></cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5471">
			十一月 30, 20129:27 上午</a>		</div>

		<p>正要学习学习Hadoop。Mark一下！</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5488">
				<div id="div-comment-5488" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/cd86a3e4c3c2a4102c7f7194c2a975e2" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Tony</cite><span class="says">说道：</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://www.alidata.org/archives/1470/comment-page-1#comment-5488">
			五月 9, 20132:20 下午</a>		</div>

		<p>文章写得非常好！<br>
我有一个问题想请教一下，就是combiner，<br>
大家都知道从map方法出来的数据都是key—&gt;value形式，<br>
但是在执行combiner的的reduce函数是(final Text key, final Iterable values 。。。。 )，<br>
也就是key—&gt;List形式， 是哪个过程将 map的结果 进行了 value 的 合并呢， 然后交给combiner再进一步处理呢？<br>
或者我的理解一直就是错误的? </p>
<p>也就是 map出来的结果可能是<br>
a 10<br>
b 11<br>
c 13<br>
a 14<br>
b 20<br>
从combiner函数定义来看输入数据应该是<br>
a [10,14]<br>
b [11,20]<br>
c 13<br>
因为函数定义为 (final Text key, final Iterable values 。。。。 ),很明显value是经过合并后的。</p>
<p>如果combiner执行的逻辑是找最大值的输出结果应该是<br>
a 14<br>
b 20<br>
c 13</p>

		<div class="reply">
					</div>
				</div>
		</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="next-posts"></div>
		<div class="prev-posts"></div>
	</div>
	
 

<div id="respond">

	<h2>Leave a Reply</h2>

	<div class="cancel-comment-reply">
		<a rel="nofollow" id="cancel-comment-reply-link" href="http://www.alidata.org/archives/1470#respond" style="display:none;">点击这里取消回复。</a>	</div>

	
	<form action="http://www.alidata.org/wp-comments-post.php" method="post" id="commentform">

		
			<div>
				<input type="text" name="author" id="author" value="" size="22" tabindex="1" aria-required="true">
				<label for="author">Name (required)</label>
			</div>

			<div>
				<input type="text" name="email" id="email" value="" size="22" tabindex="2" aria-required="true">
				<label for="email">Mail (will not be published) (required)</label>
			</div>

			<div>
				<input type="text" name="url" id="url" value="" size="22" tabindex="3">
				<label for="url">Website</label>
			</div>

		
		<!--<p>You can use these tags: <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; &lt;pre lang=&quot;&quot; line=&quot;&quot; escaped=&quot;&quot; highlight=&quot;&quot;&gt; </code></p>-->

		<div>
			<textarea name="comment" id="comment" cols="58" rows="10" tabindex="4"></textarea>
		<div id="captchaImgDiv">

<div class="captchaSizeDivSmall"><img id="si_image_com" class="si-captcha" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/securimage_show.php" width="132" height="45" alt="验证图片" title="验证图片">
    <input id="si_code_com" name="si_code_com" type="hidden" value="EBlmweWmOfI7OCUy">
    <div id="si_refresh_com">
<a href="http://www.alidata.org/archives/1470#" rel="nofollow" title="刷新验证码" onclick="si_captcha_refresh(&#39;si_image_com&#39;,&#39;com&#39;,&#39;/wp-content/plugins/si-captcha-for-wordpress/captcha&#39;,&#39;http://www.alidata.org/wp-content/plugins/si-captcha-for-wordpress/captcha/securimage_show.php?si_sm_captcha=1&amp;si_form_id=com&amp;prefix=&#39;); return false;">
      <img class="captchaImgRefresh" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/refresh.png" width="22" height="20" alt="刷新验证码" onclick="this.blur();"></a>
  </div>
  </div>
<div id="captchaInputDiv"><input id="captcha_code" name="captcha_code" type="text" value="" tabindex="4">
 <label id="captcha_code_label" for="captcha_code">验证码</label><span class="required"> *</span>
 </div>
</div></div>

		<div>
			<input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment">
			<input type="hidden" name="comment_post_ID" value="1470" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
		</div>
		
		

      <script type="text/javascript">
          var sUrlInput = document.getElementById("comment");
                  var oParent = sUrlInput.parentNode;
          var sSubstitue = document.getElementById("captchaImgDiv");
                  oParent.appendChild(sSubstitue, sUrlInput);
      </script>
            <noscript>
          &lt;style type='text/css'&gt;#submit {display:none;}&lt;/style&gt;&lt;br /&gt;           &lt;input name="submit" type="submit" id="submit-alt" tabindex="6" value="提交" /&gt;
          </noscript>
  <p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="51de4b74d5"></p>
	</form>

		
</div>

				
				</div>
	</div>
		
	<div id="sidebar" class="col-sub">

    <div id="search-3" class="widget widget_search"><form action="http://www.alidata.org/" id="searchform" method="get">
    <div class="wrap">
        <label for="s" class="screen-reader-text">Search for:</label>
        <input type="text" id="s" name="s" class="field" placeholder="serach" value="">
        
        <input type="submit" value="Search" id="searchsubmit" class="submit">
    </div>
</form></div><div id="categories-4" class="widget widget_categories"><h2>分类目录</h2>		<ul>
	<li class="cat-item cat-item-54"><a href="http://www.alidata.org/archives/category/cc" title="查看C/C++下的所有文章">C/C++</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="http://www.alidata.org/archives/category/dw%e6%9e%b6%e6%9e%84" title="查看dw架构下的所有文章">dw架构</a> (20)
</li>
	<li class="cat-item cat-item-5"><a href="http://www.alidata.org/archives/category/etl" title="查看ETL下的所有文章">ETL</a> (7)
</li>
	<li class="cat-item cat-item-30"><a href="http://www.alidata.org/archives/category/greenplum" title="查看greenplum下的所有文章">greenplum</a> (9)
</li>
	<li class="cat-item cat-item-34"><a href="http://www.alidata.org/archives/category/cloud-computing/hadoop" title="查看hadoop下的所有文章">hadoop</a> (22)
</li>
	<li class="cat-item cat-item-37"><a href="http://www.alidata.org/archives/category/cloud-computing/hive" title="查看Hive下的所有文章">Hive</a> (14)
</li>
	<li class="cat-item cat-item-51"><a href="http://www.alidata.org/archives/category/java" title="查看java下的所有文章">java</a> (13)
</li>
	<li class="cat-item cat-item-35"><a href="http://www.alidata.org/archives/category/cloud-computing" title="云计算平台技术">云计算</a> (17)
</li>
	<li class="cat-item cat-item-102"><a href="http://www.alidata.org/archives/category/%e5%9b%be%e6%95%b0%e6%8d%ae%e5%ba%93" title="查看图数据库下的所有文章">图数据库</a> (2)
</li>
	<li class="cat-item cat-item-4"><a href="http://www.alidata.org/archives/category/%e5%b1%95%e7%8e%b0" title="查看展现下的所有文章">展现</a> (13)
</li>
	<li class="cat-item cat-item-84"><a href="http://www.alidata.org/archives/category/%e5%bc%80%e5%8f%91%e6%8a%80%e6%9c%af" title="查看开发技术下的所有文章">开发技术</a> (2)
</li>
	<li class="cat-item cat-item-1"><a href="http://www.alidata.org/archives/category/%e6%89%80%e6%9c%89" title="全部文章">所有</a> (131)
</li>
	<li class="cat-item cat-item-38"><a href="http://www.alidata.org/archives/category/%e6%8b%9b%e8%81%98" title="查看招聘下的所有文章">招聘</a> (39)
</li>
	<li class="cat-item cat-item-12"><a href="http://www.alidata.org/archives/category/%e6%8e%a8%e8%8d%90%e5%bc%95%e6%93%8e" title="查看推荐引擎下的所有文章">推荐引擎</a> (10)
</li>
	<li class="cat-item cat-item-6"><a href="http://www.alidata.org/archives/category/%e6%95%b0%e6%8d%ae%e6%8c%96%e6%8e%98" title="查看数据挖掘下的所有文章">数据挖掘</a> (32)
</li>
	<li class="cat-item cat-item-66"><a href="http://www.alidata.org/archives/category/%e9%ab%98%e6%80%a7%e8%83%bd%e6%9c%8d%e5%8a%a1%e5%99%a8" title="查看高性能服务器下的所有文章">高性能服务器</a> (15)
</li>
		</ul>
</div><div id="recent-comments-3" class="widget widget_recent_comments"><h2>近期评论</h2><ul id="recentcomments"><li class="recentcomments"><a href="http://guanmian.net/?p=2379" rel="external nofollow" class="url">Technology Heartbeat #20 | Steve Guan</a>发表在《<a href="http://www.alidata.org/archives/1789/comment-page-1#comment-5653">淘宝数据魔方技术架构解析</a>》</li><li class="recentcomments"><a href="http://www.xsseyes.com/archives/226.html" rel="external nofollow" class="url">Ubuntu下Postgresql-8.4安装及配置 | XEyes 's Blog</a>发表在《<a href="http://www.alidata.org/archives/721/comment-page-1#comment-5648">Ubuntu下Postgresql-8.4安装及配置</a>》</li><li class="recentcomments"><a href="http://www.tanghuangwhu.com/archives/544" rel="external nofollow" class="url">hadoop重新入门 | On The Way</a>发表在《<a href="http://www.alidata.org/archives/244/comment-page-1#comment-5644">hadoop使用中的几个小细节(一)</a>》</li><li class="recentcomments"><a href="http://www.chawenti.com/articles/20577.html" rel="external nofollow" class="url">Web开发基本准则-55实录-缓存策略 – 旁观者 | 查问题</a>发表在《<a href="http://www.alidata.org/archives/1789/comment-page-1#comment-5642">淘宝数据魔方技术架构解析</a>》</li><li class="recentcomments">eagoo发表在《<a href="http://www.alidata.org/archives/2410/comment-page-1#comment-5641">资深数据开发工程师</a>》</li></ul></div><div id="linkcat-11" class="widget widget_links"><h2>Tech@Alibaba</h2>
	<ul class="xoxo blogroll">
<li><a href="http://rdc.taobao.com/blog/dba">淘宝DBA</a></li>
<li><a href="http://rdc.taobao.com/blog/qa">淘宝QA</a></li>
<li><a href="http://ued.taobao.com/">淘宝UED</a></li>
<li><a href="http://rdc.taobao.com/blog/cs/" title="淘宝核心系统博客">淘宝核心系统</a></li>

	</ul>
</div>
<div id="linkcat-10" class="widget widget_links"><h2>友情链接</h2>
	<ul class="xoxo blogroll">
<li><a href="http://cnodejs.org/" target="_blank">CNodeJS.ORG</a></li>
<li><a href="http://www.dbanotes.net/" title="Fenng的博客">www.dbanotes.net</a></li>
<li><a href="http://data.taobao.com/" target="_blank">数据魔方官方网站</a></li>
<li><a href="http://www.linezing.com/blog/" target="_blank">量子官方博客</a></li>
<li><a href="http://www.alidw.com/" target="_blank">阿里巴巴数据仓库团队blog</a></li>

	</ul>
</div>
<div id="meta-4" class="widget widget_meta"><h2>功能</h2>			<ul>
						<li><a href="http://www.alidata.org/wp-login.php">登录</a></li>
			<li><a href="http://www.alidata.org/feed" title="使用RSS 2.0订阅本站点内容">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://www.alidata.org/comments/feed" title="使用RSS订阅本站点的所有文章的近期评论">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>						</ul>
</div>
</div></div>



	</div>
		<footer id="footer" class="source-org vcard copyright">
					<div id="ft">
			<a href="http://www.alidata.org/">首页</a>
			<span class="sep">|</span> 
			<a href="http://www.alidata.org/about-us#about">关于我们</a>
			<span class="sep">|</span> 
			<a href="http://www.alidata.org/join-us">加入我们</a> 
			<span class="sep">|</span> 
			<a href="http://www.alidata.org/p_d/tech">产品与技术</a> 
			<span class="sep">|</span> 
			<a href="http://www.alidata.org/archives">官方博客</a>
			
			<p>
			<small>© 2015阿里数据平台 alidata.org</small>
			</p>
		</div>
		</footer>

	<script type="text/javascript" src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/si_captcha.js"></script>
<script type="text/javascript">
//<![CDATA[
var si_captcha_styles = "\
<!-- begin SI CAPTCHA Anti-Spam - comment form style -->\
<style type='text/css'>\
div#captchaImgDiv { display:block; }\
.captchaSizeDivSmall { width:175px; height:45px; padding-top:10px; }\
.captchaSizeDivLarge { width:250px; height:60px; padding-top:10px; }\
img#si_image_com,#si_image_reg,#si_image_log,#si_image_side_login { border-style:none; margin:0; padding-right:5px; float:left; }\
.captchaImgRefresh { border-style:none; margin:0; vertical-align:bottom; }\
div#captchaInputDiv { display:block; padding-top:15px; padding-bottom:5px; }\
label#captcha_code_label { margin:0; }\
input#captcha_code { width:65px; }\
</style>\
<!-- end SI CAPTCHA Anti-Spam - comment form style -->\
";
jQuery(document).ready(function($) {
$('head').append(si_captcha_styles);
});
//]]>
</script>


<!-- here comes the javascript -->

<!-- jQuery is called via the Wordpress-friendly way via functions.php -->

<!-- this is where we put our custom functions -->
<script src="./hadoop作业调优参数整理及原理 - 阿里数据平台 alidata.org_files/functions.js"></script>
	 
	
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44966005-1', 'alidata.org');
  ga('send', 'pageview');

</script>



</body></html>